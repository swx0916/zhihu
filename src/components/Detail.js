import React from 'react'
import axios from 'axios'
import '../asstes/detail.css'
import Back from '../asstes/img/detail_back.jpg'
import Enjoy from '../asstes/img/detail_enjoy.jpg'
import Cang from '../asstes/img/detail_cang.jpg'
import Msg from '../asstes/img/detail_msg.jpg'
import Zan from '../asstes/img/detail_zan.jpg'
import XingCang from '../asstes/img/星星.svg'
import ZanRed from '../asstes/img/赞.svg'
import '../asstes/detailmain.css'

import '../../node_modules/antd/dist/antd.css'


import $ from 'jquery'



class Detail extends React.Component{
    constructor(props){
        super(props)
        this.state={
            newsId:'',
            body:'',
            css:"",
            mainImg:'',
            title:'',
            name:'',
            height:document.documentElement.clientHeight,
            comments:'',
            popularity:'',
            tag:true
        }
    }
    render(){
        return(
            <div className="detail">
                <div className="topBox"></div>
                <div className="top clearfix">
                    <img src={Back} onClick={this.back.bind(this)} className="fl back" alt=""/>
                    <div className="fr imgRight"  style={{'position':'relative'}}>
                        <img src={Enjoy} onClick={this.enjoy.bind(this)} alt=""/>
                        <img ref="cang" src={Cang} onClick={this.cang.bind(this,)} alt=""/>
                        <img src={Msg} alt="" onClick={this.comment.bind(this,this.props.location.state.newsId)}/>
                        <span style={{'position':'absolute','left':'2.8rem','top':'0.09rem'}}>{this.state.comments}</span>
                        <img src={Zan} tag={this.state.tag} onClick={this.zan.bind(this)} alt=""/>
                        <span className="zanCount" style={{'position':'absolute','left':'4rem','top':'0.1rem'}}>{this.state.popularity}</span>
                    </div>
                </div>
                <div className="main">
                    <img src={this.state.mainImg} className="topImg" alt=""/>
                    <span className="title">{this.state.title}</span>
                    <i>{this.state.name}</i>
                    <div dangerouslySetInnerHTML = {{ __html: this.state.body }}/>
                </div>
                <div className="enjoyDiv"  ref="app">
                    {/*分享出现灰盒子*/}
                    <div className="gray" onClick={this.gray.bind(this)} style={{'height':this.state.height}}>
                    </div>
                    <ul className="app">
                        <h2>分享</h2>
                        <li>
                            <svg t="1571149771461" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7499" width="1.12rem" height="1.12rem"><path d="M512 0a512 512 0 1 0 512 512A512 512 0 0 0 512 0z" fill="#D80000" p-id="7500"></path><path d="M410.655066 542.127991c-63.18672 8.85083-108.613165 57.676932-101.520779 109.257928s64.183171 86.339554 127.369892 77.605953 108.613165-57.676932 101.520778-109.316543S473.900401 533.39439 410.655066 542.127991z m-18.463652 145.716314c-22.214997 3.106583-42.261248-9.143904-44.781683-27.255868s13.481397-35.168861 35.696394-38.392673 42.261248 9.143904 44.781683 27.314482-13.481397 35.28609-35.696394 38.334059z m56.680481-58.614769a14.477848 14.477848 0 1 1 13.364167-18.053348 16.001832 16.001832 0 0 1-13.364167 18.346422zM738.546079 456.609044a25.966342 25.966342 0 0 0 34.05518-13.833085 92.611334 92.611334 0 0 0-121.33257-121.33257 26.024957 26.024957 0 0 0 20.515169 47.82965 40.678649 40.678649 0 0 1 53.22221 53.22221A25.966342 25.966342 0 0 0 738.546079 456.609044z m-60.549056 38.334058l5.099485-14.536462c45.48506-87.336005-71.803091-115.822782-139.092845-78.719634s-34.817172-25.731883-34.817172-25.731883c11.136806-114.826331-109.609616-64.007327-109.609616-64.007327-280.354436 157.204808-252.043503 313.061477-252.043504 313.061477 0 85.753406 134.403663 181.705781 303.976188 181.705781 224.611792 0 352.68506-131.297081 330.411448-228.597595-8.557756-39.916657-55.097882-73.678764-103.63091-83.174357zM418.56806 761.991986c-147.064453 0-196.828392-76.199199-196.828392-131.765999 0-87.570464 116.057241-152.398397 225.315169-152.398397s187.09834 46.422896 205.151688 107.265026C678.407327 675.183515 563.287922 761.991986 418.56806 761.991986z m268.983171-544.413967a189.501546 189.501546 0 0 0-47.419348 5.861477 25.966342 25.966342 0 0 0 13.012479 50.350086 137.334402 137.334402 0 0 1 163.359359 180.005953 25.966342 25.966342 0 1 0 48.826102 17.584431 189.384316 189.384316 0 0 0-177.778592-254.21225z" fill="#FFFFFF" p-id="7501"></path></svg>
                            <span>新浪微博</span>
                        </li>
                        <li>
                            <svg t="1571149870816" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8325" width="1.12rem" height="1.12rem"><path d="M369.57 399.21m-21.76 0a21.76 21.76 0 1 0 43.52 0 21.76 21.76 0 1 0-43.52 0Z" fill="#3DB135" p-id="8326"></path><path d="M481.46 398.41c0.01 12.02 9.75 21.76 21.77 21.75 12.02-0.01 21.76-9.75 21.75-21.77 0-12.02-9.75-21.76-21.77-21.75-12.01 0-21.75 9.74-21.75 21.76v0.01zM650.98 533.25c-0.01 11.27 9.1 20.4 20.36 20.42 11.27 0.01 20.4-9.11 20.42-20.36 0.01-11.27-9.11-20.4-20.36-20.42-3.6-0.01-7.13 0.93-10.24 2.74a20.356 20.356 0 0 0-10.18 17.62zM548.11 533.25c-0.01 11.27 9.1 20.4 20.36 20.42 11.27 0.01 20.4-9.11 20.42-20.36 0.01-11.27-9.11-20.4-20.36-20.42-3.6-0.01-7.13 0.93-10.24 2.74a20.335 20.335 0 0 0-10.18 17.62z" fill="#3DB135" p-id="8327"></path><path d="M511.53 63.99C264.11 64.26 63.73 265.05 64 512.48S265.06 960.27 512.47 960C759.71 959.74 960 759.24 960 512c0.01-247.4-200.53-447.99-447.94-448-0.18 0-0.35 0-0.53-0.01z m-76.65 551.45c-22.3-0.85-44.43-4.13-66.03-9.76l-66.06 32.56 18.75-56.2c-45.2-26.62-73.53-74.61-75.04-127.05 0-89.6 84.82-159.65 188.37-159.65 92.28 0 173.69 56.2 190 131.96-5.93-0.68-11.9-0.96-17.87-0.83-84.92-3.33-156.45 62.82-159.78 147.72-0.01 0.44-0.03 0.88-0.04 1.32 0.17 13.23 2.09 26.38 5.69 39.11-6.52 0-12.23 0.8-17.87 0.8h-0.12z m275.61 65.99l13.84 47.24-51.38-28.52a226.832 226.832 0 0 1-56.26 9.76c-89.69 0-159.82-61.08-159.82-136.01S527 437.86 616.69 437.86c84.82 0 159.86 61.08 159.86 136.04a141.56 141.56 0 0 1-66.06 107.53z" fill="#3DB135" p-id="8328"></path></svg>
                            <span>微信</span>
                        </li>
                        <li>
                            <svg t="1571149978552" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9041"width="1.12rem" height="1.12rem"><path d="M0.512 512c0 282.624 228.864 511.488 511.488 511.488s511.488-228.864 511.488-511.488S794.624 0.512 512 0.512 0.512 229.376 0.512 512z" fill="#8DC71B" p-id="9042"></path><path d="M593.92 299.52V527.36l119.808-120.32c-25.6-49.152-68.096-87.552-119.808-107.52zM722.432 419.84l-160.768 160.768 171.008 0.512c15.872-52.736 12.8-110.08-10.24-161.28z m-99.84 297.472c48.64-25.6 87.04-68.608 106.496-120.832l-228.352-1.536 121.856 122.368z m-174.592 17.92c52.736 16.896 110.592 13.824 161.792-9.216l-162.304-164.352 0.512 173.568z m-137.216-112.64c26.112 49.664 69.12 89.088 121.856 109.056V500.224l-121.856 122.368zM291.84 445.44c-16.384 53.76-13.312 112.128 10.24 163.84l163.328-163.328L291.84 445.44z m111.616-138.752C353.792 332.8 314.88 376.832 294.912 430.08l231.936 1.536-123.392-124.928z m177.664-17.92C527.36 271.36 468.992 274.432 416.768 297.984l164.864 166.912-0.512-176.128z" fill="#FFFFFF" p-id="9043"></path></svg>
                            <span>微信朋友圈</span>
                        </li>
                        <li>
                            <svg t="1571150012150" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9187" width="1.12rem" height="1.12rem"><path d="M572.727663 916.238117c-32.203241-1.688387-61.763834-16.7866-83.224471-42.567008-26.134673-31.383109-37.709697-75.626218-31.713824-121.374438 7.4631-57.334507 53.223607-98.947254 108.82058-98.947254 7.732382 0 15.612203 0.820132 23.393732 2.447086 14.364087 2.997936 38.370103 13.299246 37.954405 48.611003-0.098293 12.957269-0.367575 46.39634-34.16091 54.44715-0.122866 2.251524-0.116723 7.249108 0.22935 9.468892 0.172013 1.100677 1.637193 2.779849 3.437183 2.837186 10.654551 0.33993 42.491241-0.255971 42.491241-0.255971 6.362423-0.049146 8.066169-1.629002 9.219064-2.995889 1.115011-1.32286 2.015006-3.951173 1.957668-10.88902-0.088054-10.679124-0.080887-33.010063-0.734126-42.713424-2.253572-33.473883-17.129601-65.018766-27.333642-66.413298-7.781528-1.064841-36.803558-5.897579-43.606252-6.851841-15.465788-2.165517-39.29979-5.517718-60.785-21.399203-9.543635 26.428528-24.078711 47.864591-62.742669 47.864591-6.656278 0-123.062825-19.69853-159.989249-29.927144-37.953381-10.522469-65.9976-36.473867-76.935768-71.19689-21.265074-67.550834-33.060233-125.497624-38.247236-187.898315-2.276097-26.893372-5.089734-60.381589 16.395476-83.763035 13.312557-14.46238 33.304942-21.803638 59.464188-21.803638 6.239557 0 13.067848 0.403411 20.604668 1.284976 23.834003 2.728654 40.914458-1.382245 51.950918-12.529284 14.437807-14.596509 16.370902-38.590238 16.224486-51.596654-0.612283-61.885677 31.958533-95.838738 94.211785-98.213128l2.961076-0.110579c9.959333-0.378838 19.967812-0.758699 29.879022-0.758699 42.187147 0 89.734334 6.557986 123.87067 54.459436 1.369959 0.03686 115.012015 9.605068 149.442207 20.615931 42.701137 13.654535 68.664822 41.380325 73.094149 78.061017 0 0 41.69773 344.192362 3.132065 494.784393-3.181212 12.504711-7.170269 25.314541-11.844305 38.014814-30.514854 82.796487-82.393076 119.698338-168.211049 119.698338-0.002048 0.002048-59.270674 0.12389-69.205432-0.390101z m-6.117715-212.771561c-30.099157 0-54.96114 23.259603-59.14576 55.316428-4.160046 31.946246 3.327627 62.131409 20.555522 82.82106 12.601981 15.122786 29.050698 25.26437 47.403843 26.230918 9.078791 0.464844 47.951621 1.040267 66.559713 0.330715 64.999312-2.47985 97.780025-25.191675 121.125634-88.545602a340.048699 340.048699 0 0 0 10.326907-33.09607c36.216872-141.513239-4.355608-476.382101-4.355608-476.382101-1.982242-16.554178-14.976371-28.777321-38.590238-36.326427-29.193018-9.335786-127.149151-18.194442-128.812965-18.205705-11.403011-0.575424-31.909386 0.012287-44.658806-18.903995-19.992385-29.634313-47.179612-35.592302-84.57088-35.592302-9.274353 0-18.622426 0.367575-27.969476 0.721839l-2.961076 0.121843c-35.188891 1.334123-46.347193 12.895836-46.005215 47.595309 0.391124 35.935303-10.522469 66.964148-30.710417 87.37223-22.121042 22.365751-52.04921 31.8971-93.403938 27.052075-18.915257-2.214664-32.692658-0.391124-37.342122 4.661749-6.607132 7.182556-4.723183 29.426464-3.376774 45.662214 4.894172 58.570336 16.027901 113.164926 36.143152 177.032845 7.439551 23.699874 27.2118 33.720639 42.481002 37.942118 37.342122 10.351481 141.537812 28.116915 146.62857 28.116915 10.228614 0 11.281169 0 18.964404-24.98485 1.345385-4.367895 9.200634-33.157502 9.200633-33.157502 2.862783-10.240901 11.867855-17.582159 22.464044-18.291711 10.473323-0.61126 20.530949 5.334443 24.715568 15.110499 10.791751 25.131265 25.743549 31.21212 55.156703 35.347593 7.218392 1.015694 36.118579 5.82386 43.41069 6.827268 50.213384 6.864127 67.979842 74.08527 70.573343 112.711344 0.709553 10.804038 0.832419 45.417505 0.832419 45.417505 0.244709 19.650407-5.237173 35.32302-16.272609 46.616475-10.938167 11.158302-26.208393 16.89718-45.368359 17.043595l-39.030509 0.024574c-12.773993-0.269282-51.681636-1.052554-56.110963-43.435264-5.040587-48.769706 17.227894-62.240965 33.280368-65.716031 0.049146-1.725247 0.07372-3.646056 0.07372-5.175741 0.024573-0.415697 0.024573-0.807846 0.024573-1.16211-4.35868-0.807846-7.833747-1.101701-11.235093-1.1017z" fill="#3E3A39" p-id="9188"></path><path d="M185.237237 229.970787l110.600093-110.622618c0 26.940471 0.469963 57.553618-0.180204 88.142192-0.375766 17.668165-13.395492 22.166093-28.125106 22.367799-28.096437 0.387029-56.202089 0.112627-82.294783 0.112627zM631.844753 417.88958c34.067736-0.46382 62.128338 23.478714 64.892828 55.285712 1.251188 14.396852-2.809541 23.442878-19.546994 19.205017-27.011119-6.839554-54.390836-9.997216-82.248708-9.220087-15.087974 0.420817-18.788296-7.526581-15.894796-21.155519 5.353896-25.216248 27.23023-43.767002 52.79767-44.115123z" fill="#3E3A39" p-id="9189"></path></svg>
                            <span>印象笔记</span>
                        </li>
                        <li>
                            <svg t="1571150147614" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="9413" width="1.12rem" height="1.12rem"><path d="M552.96 545.28h-115.2c-23.04 0-23.04 0-23.04-23.04v-40.96H563.2v-161.28c0-12.8-7.68-12.8-15.36-12.8h-99.84c-17.92 0-23.04-2.56-23.04-23.04V243.2h140.8c-2.56-12.8-2.56-25.6-2.56-40.96h53.76c2.56 0 7.68 10.24 7.68 15.36 2.56 28.16 0 28.16 30.72 28.16H691.2c56.32 0 89.6 30.72 89.6 89.6v143.36c23.04-2.56 23.04 10.24 23.04 25.6-2.56 46.08 10.24 40.96-43.52 40.96h-89.6c7.68 25.6 15.36 46.08 23.04 66.56 17.92 43.52 51.2 71.68 97.28 87.04 10.24 2.56 12.8 7.68 12.8 17.92v46.08c-51.2-5.12-92.16-25.6-128-58.88-35.84-35.84-51.2-79.36-64-128-30.72 104.96-92.16 171.52-207.36 186.88v-58.88c2.56-2.56 0 0 17.92-7.68 61.44-20.48 99.84-64 120.32-122.88 7.68-5.12 7.68-15.36 10.24-28.16z m74.24-235.52v163.84c0 2.56 7.68 7.68 12.8 7.68h61.44c12.8 0 17.92-5.12 17.92-17.92v-117.76c0-23.04-12.8-35.84-35.84-35.84h-56.32zM291.84 204.8H353.28v181.76h53.76v64h-15.36c-38.4 2.56-38.4 2.56-38.4 40.96v256c0 23.04 0 23.04-23.04 23.04h-35.84c-2.56-192-2.56-378.88-2.56-565.76zM248.32 755.2H192V212.48h56.32v542.72z" fill="#FFFFFF" p-id="9414"></path><path d="M998.4 711.68V25.6H296.96c-102.4 7.68-202.24 89.6-250.88 212.48-10.24 28.16-17.92 58.88-20.48 87.04v371.2c0 58.88 23.04 120.32 64 176.64 20.48 25.6 43.52 48.64 69.12 66.56 35.84 25.6 76.8 40.96 115.2 48.64h478.72c69.12-10.24 140.8-51.2 192-122.88 28.16-48.64 48.64-102.4 53.76-153.6z" fill="#3BA1FF" p-id="9415"></path><path d="M637.44 250.88l53.76 53.76s-23.04 25.6-53.76 53.76L299.52 691.2l-53.76 53.76s2.56-35.84 5.12-76.8l7.68-143.36c2.56-40.96 28.16-99.84 58.88-130.56l181.76-176.64c30.72-28.16 79.36-28.16 110.08 0l28.16 33.28z" fill="#FFFFFF" p-id="9416"></path><path d="M775.68 389.12c30.72 30.72 30.72 79.36 0 107.52l-181.76 181.76c-30.72 30.72-89.6 56.32-130.56 56.32l-143.36 7.68c-40.96 2.56-76.8 2.56-76.8 2.56s25.6-25.6 56.32-53.76l337.92-332.8c30.72-30.72 53.76-53.76 56.32-53.76l53.76 53.76 28.16 30.72z" fill="#EBF6FA" p-id="9417"></path></svg>
                            <span>有道云笔记</span>
                        </li>

                        <li>
                            <svg t="1571149579173" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6551" width="1.12rem" height="1.12rem"><path d="M512 11c-276.7 0-501 224.3-501 501s224.3 501 501 501 501-224.3 501-501S788.7 11 512 11z" fill="#158ee1" p-id="6552"></path><path d="M737.8 598.7c-10.5-62.9-54.4-104.1-54.4-104.1 6.3-57.1-16.7-67.2-16.7-67.2-4.9-176.8-151.6-173.7-154.7-173.6-3.1-0.1-149.8-3.2-154.7 173.5 0 0-23 10.1-16.7 67.2 0 0-43.9 41.2-54.4 104.1 0 0-5.6 106.3 50.2 13 0 0 12.6 35.4 35.5 67.2 0 0-41.1 14.5-37.6 52.1 0 0-1.4 41.9 87.8 39.1 0 0 62.7-5.1 81.6-32.5h16.6c18.8 27.5 81.6 32.5 81.6 32.5 89.2 2.9 87.8-39.1 87.8-39.1 3.5-37.6-37.6-52.1-37.6-52.1 23-31.8 35.5-67.2 35.5-67.2 55.7 93.4 50.2-12.9 50.2-12.9z" fill="#ffffff" p-id="6553"></path></svg>
                            <span>QQ</span>
                        </li>
                        <li>
                            <svg t="1571150818264" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11644" width="1.12rem" height="1.12rem"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#9EAFC8" p-id="11645"></path><path d="M279.272727 512m-93.090909 0a93.090909 93.090909 0 1 0 186.181818 0 93.090909 93.090909 0 1 0-186.181818 0Z" fill="#F3F4F6" p-id="11646"></path><path d="M512 512m-93.090909 0a93.090909 93.090909 0 1 0 186.181818 0 93.090909 93.090909 0 1 0-186.181818 0Z" fill="#F3F4F6" p-id="11647"></path><path d="M744.727273 512m-93.090909 0a93.090909 93.090909 0 1 0 186.181818 0 93.090909 93.090909 0 1 0-186.181818 0Z" fill="#F3F4F6" p-id="11648"></path></svg>
                            <span>更多</span>
                        </li>

                    </ul>
                </div>
            </div>
        )
    }
    //点击分享后点击灰盒子消失
    gray(){
        this.refs.app.style.display = 'none'
    }
    //分享
    enjoy(){
        this.refs.app.style.display = 'block'
        if(this.refs.app.style.display === 'block'){
            document.body.style.overflow = 'hidden'
        }else{
            document.body.style.overflow = ''
        }
    }
    //回退
    back(){
        this.props.history.go(-1)
    }
    //评论
    comment(x){
        this.props.history.push({
            pathname:'/comments',
            state:{newsId:x}
        })
    }
    //收藏
    cang(ev){
        this.state.tag = !this.state.tag
        if(this.state.tag ){
            ev.target.src = XingCang;
            localStorage.setItem(this.props.location.state.newsId,JSON.stringify({id:this.props.location.state.newsId,img:this.state.mainImg,title:this.state.title}))
        }else{
            ev.target.src = Cang;
            localStorage.removeItem(this.props.location.state.newsId)
        }
    }
    //点赞
    zan(ev){
        this.state.tag = !this.state.tag
        if(!this.state.tag){
            var num = Number(this.state.popularity)
            num++
            this.setState({
                popularity:num
            })
            ev.target.src = ZanRed
        }else{
            var num = Number(this.state.popularity)
            num--
            this.setState({
                popularity:num
            })
            ev.target.src = Zan
        }
    }
    componentDidMount(){
        for(var i = 0;i<localStorage.length;i++){
            if((JSON.parse(localStorage.getItem(localStorage.key(i))).id) === this.props.location.state.newsId){
                this.refs.cang.src = XingCang;
            }
        }
        axios({
            url:'/api/4/news/'+ this.props.location.state.newsId,
            method:'get'
        }).then(res=>{
            this.setState({
                body:res.data.body,
                css:res.data.css,
                mainImg:res.data.image,
                title:res.data.title,
                name:res.data.image_source
            })
            axios({
                url:'/api/4/story-extra/'+this.props.location.state.newsId,
                method:'get'
            }).then(res=>{
                this.setState({
                    popularity:  res.data.popularity,
                    comments: res.data.comments
                })
            })
        })

    }
}
export default Detail
